<!DOCTYPE html>
<html dir="ltr" lang="en">
  <%- include("./partials/head.ejs") %>
  <meta
    name="pages"
    content="<%= (locals.agents && locals.agents.pages)? locals.agents.pages : '' %> "
  />
  <meta
    name="data"
    content="<%= (locals.agents && locals.agents.pages)? locals.agents.data : ''%> "
  />
  <meta
    name="page"
    content="<%= (locals.agents && locals.agents.pages)? locals.agents.page : '' %> "
  />

  <body id="ea-listings">
  <%- include("./partials/header.ejs") %>

    <section id="ea-listings-top">
      <div class="container">
        <h1>Search Results</h1>
        <%if(locals.city && locals.city.name){%>
        <p>
          Showing all enrolled agents in <%= locals.capitalizeFirstLetter(locals.city.name) %>, <%=
          locals.capitalizeFirstLetter(locals.city.state) %>
        </p>
        <% } else {%>
        <p>No agents found</p>
        <% } %>
      </div>
    </section>

    <section id="premium" class="container">
      <% if (typeof locals !==' undefined' && locals.agents && locals.agents.data && locals.agents.data.length> 0){%> 
        <% locals.agents.data.map((e,id)=> { %>
      <div class="row premium-box">
        <div class="col-md-4 col-sm-12">
          <div class="img col-md-5">
            <img  src=<%= e.imageUrl || "/assets/images/avatar.webp" %> alt=<%= e.firstName %> <%= e.lastName %> />
          </div>
          <div class="txt col-md-7">
            <h3><%= e.firstName %> <%= e.lastName %></h3>
            <p><%= e.city %></p>
          </div>
        </div>
        <div class="col-md-4 col-sm-12 mid-div">
           <% if(e.premium) { %>
                <h4>Premium Member</h4>
            <%}%> 
          <p>
            <div class="stars-outer" id="client-stars" value=<%= e.rating || 0 %> >
                <div class="stars-inner"></div>
              </div>
              <span> <%= e.reviewCount %> reviews</span>
          </p>
        </div>
        <div class="col-md-4 col-sm-12 b-tons">
          <a href="/agent/<%= e._id %>" class="btn btn-lg btn-blu mt-2"> View profile</a>
        </div>
      </div>
      <% })} %>
    </section>

    <section id="bottom">
      <div class="container contain">
        <div class="row">
          <div class="col-md-3">
            <a href="/ea-listings" class="btn btn-lg b-ton b-ton-blu"> View All EAs</a>
          </div>
          <div class="col-md-3">
            <% if(locals.agents && locals.agents.data && locals.agents.data.length > 0){ %> 
            <% const { agents: {page, pages, perPage, total}, query} = locals %>
            <p> showing
              <span id="resNumber"> <%= (((page || 0) -1) * (perPage || 0))+ 1 || 0%> to 
                <%= Math.min((page || 1) * (perPage || 0), total) || 0%> of <%= total || 0%> entries
              </span>
            </p>
            <% } else { %>
            <p>
              No Agents found 
              <%if(locals.city && locals.city.name){%>
              <span> in <%= locals.capitalizeFirstLetter(locals.city.name) %> </span>
            <% } %>
          </p>
            <% } %>
          </div>
          <% if(locals.agents && locals.agents.data && locals.agents.pages > 1){ %> 
          <div class="col-md-6 b-tons">
            <nav class="MyPagination">
              <ul class="pagination">
                <ul id="pagination" class="pagination-sm"></ul>
              </ul>
            </nav>
          </div>
           <% } %>
        </div>
      </div>
    </section>

    <%- include("./partials/footer.ejs") %>
    <script src="/javascripts/plugin/jquery.simplePagination.js"></script>
    <script src="/javascripts/pagination.js"></script>
    <script src="/js/main.js"></script>
  </body>
</html>
